<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#020617">
  <title>Deadline Tracker</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è≥</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #020617;
      --card: linear-gradient(145deg, #0F172A 0%, #1E293B 100%);
      --text: #F1F5F9;
      --text-muted: #94A3B8;
      --text-dim: #475569;
      --text-dark: #334155;
      --border-base: #1E293B;
      --mono: 'JetBrains Mono', 'Fira Code', 'SF Mono', monospace;
      --sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    body {
      min-height: 100vh;
      min-height: 100dvh;
      background: var(--bg);
      font-family: var(--sans);
      color: var(--text);
      padding: 48px 20px;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 520px;
      margin: 0 auto;
    }

    /* Header */
    .header { margin-bottom: 40px; animation: fadeIn 0.6s ease; }

    .header-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: var(--text-dim);
      font-family: var(--mono);
      margin-bottom: 8px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #F1F5F9, #94A3B8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }

    .header-time {
      font-size: 13px;
      color: var(--text-dark);
      font-family: var(--mono);
      margin-top: 10px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      animation: fadeIn 0.6s ease 0.2s both;
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    .empty-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .empty-text {
      font-size: 13px;
      color: var(--text-dim);
      font-family: var(--mono);
      line-height: 1.6;
    }

    /* Card */
    .card {
      border-radius: 16px;
      padding: 32px 28px;
      border: 1px solid transparent;
      position: relative;
      overflow: hidden;
      margin-bottom: 20px;
      background: var(--card);
    }

    .card-glow {
      position: absolute;
      top: -60px;
      right: -60px;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      pointer-events: none;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-right: 32px;
    }

    .card-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-icon { font-size: 22px; }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2.5px;
      font-family: var(--mono);
    }

    .badge-urgent {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #0F172A;
      padding: 3px 10px;
      border-radius: 4px;
      font-family: var(--mono);
      animation: pulse 2s ease-in-out infinite;
      display: none;
    }

    .badge-urgent.visible { display: inline-block; }

    .card-subtitle {
      font-size: 15px;
      color: var(--text-muted);
      font-weight: 400;
      margin-bottom: 4px;
    }

    .card-date {
      font-size: 12px;
      color: var(--text-dim);
      font-family: var(--mono);
      margin-bottom: 24px;
    }

    /* Countdown */
    .countdown {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 4px;
    }

    .countdown-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 62px;
    }

    .countdown-value {
      font-family: var(--mono);
      font-size: 44px;
      font-weight: 700;
      line-height: 1;
      color: var(--text);
      letter-spacing: -2px;
    }

    .countdown-label {
      font-size: 10px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 6px;
      font-family: var(--mono);
    }

    .countdown-sep {
      font-family: var(--mono);
      font-size: 32px;
      font-weight: 300;
      margin-top: 4px;
      padding: 0 1px;
    }

    .done-message {
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      padding: 20px 0;
      font-family: var(--mono);
    }

    /* Progress */
    .progress-track {
      width: 100%;
      height: 3px;
      background: var(--border-base);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 20px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 2px;
      transition: width 1s ease;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 10px;
      color: var(--text-dim);
      font-family: var(--mono);
    }

    /* Delete Button */
    .delete-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: #1E293B;
      color: #475569;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      z-index: 2;
    }

    .delete-btn:hover, .delete-btn:active {
      background: #EF444433;
      color: #EF4444;
    }

    /* Add Button */
    .add-btn {
      width: 100%;
      padding: 18px;
      border-radius: 16px;
      border: 2px dashed #1E293B;
      background: transparent;
      color: #475569;
      font-family: var(--mono);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .add-btn:hover, .add-btn:active {
      border-color: #334155;
      color: #94A3B8;
      background: #0F172A;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(2, 6, 23, 0.85);
      backdrop-filter: blur(8px);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: linear-gradient(145deg, #0F172A 0%, #1E293B 100%);
      border-radius: 20px 20px 16px 16px;
      padding: 28px 24px;
      width: 100%;
      max-width: 520px;
      border: 1px solid #1E293B;
      animation: slideUp 0.3s ease;
      max-height: 85vh;
      overflow-y: auto;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 20px;
    }

    .field { margin-bottom: 16px; }

    .field label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-dim);
      font-family: var(--mono);
      margin-bottom: 6px;
    }

    .field input {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #1E293B;
      background: #020617;
      color: var(--text);
      font-size: 15px;
      font-family: var(--sans);
      outline: none;
      transition: border-color 0.2s;
    }

    .field input:focus { border-color: #334155; }

    /* Fix for date input on mobile */
    .field input[type="datetime-local"] {
      color-scheme: dark;
    }

    .icon-picker {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .icon-option {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      border: 2px solid #1E293B;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-option:hover, .icon-option:active { border-color: #334155; }
    .icon-option.selected { border-color: #94A3B8; background: #1E293B; }

    .color-picker {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .color-option {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.15s;
      outline: 2px solid transparent;
    }

    .color-option:hover { outline-color: #334155; }
    .color-option.selected { outline-color: #94A3B8; border-color: #020617; }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 24px;
    }

    .btn {
      flex: 1;
      padding: 14px;
      border-radius: 10px;
      border: none;
      font-family: var(--mono);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.5px;
    }

    .btn-cancel { background: #1E293B; color: #94A3B8; }
    .btn-cancel:hover, .btn-cancel:active { background: #334155; }

    .btn-save { background: #F1F5F9; color: #0F172A; }
    .btn-save:hover, .btn-save:active { background: #CBD5E1; }

    .btn-danger { background: #7F1D1D; color: #FCA5A5; }
    .btn-danger:hover, .btn-danger:active { background: #991B1B; }

    /* Confirm dialog */
    .confirm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(2, 6, 23, 0.85);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }

    .confirm-overlay.open { display: flex; }

    .confirm-box {
      background: linear-gradient(145deg, #0F172A 0%, #1E293B 100%);
      border-radius: 16px;
      padding: 24px;
      width: 100%;
      max-width: 340px;
      border: 1px solid #1E293B;
      animation: slideUp 0.2s ease;
      text-align: center;
    }

    .confirm-text {
      font-size: 15px;
      color: var(--text-muted);
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .confirm-name {
      color: var(--text);
      font-weight: 600;
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 36px;
      font-size: 11px;
      color: var(--border-base);
      font-family: var(--mono);
      letter-spacing: 1px;
      animation: fadeIn 0.6s ease 0.9s both;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Mobile tweaks */
    @media (max-width: 400px) {
      body { padding: 32px 16px; }
      .card { padding: 24px 20px; }
      .countdown-value { font-size: 36px; }
      .countdown-unit { min-width: 52px; }
      .countdown-sep { font-size: 28px; }
      .header h1 { font-size: 24px; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <div class="header-label">Deadline Tracker</div>
      <h1>Meine Deadlines</h1>
      <div class="header-time" id="headerTime"></div>
    </div>

    <div id="cards"></div>

    <button class="add-btn" id="addBtn" onclick="openModal()">
      <span style="font-size: 20px; line-height: 1;">+</span> Neue Deadline
    </button>

    <div class="footer">Deadline Tracker</div>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <div class="modal-title" id="modalTitle">Neue Deadline</div>

      <div class="field">
        <label>Titel *</label>
        <input type="text" id="inputTitle" placeholder="z.B. Projektabgabe">
      </div>

      <div class="field">
        <label>Beschreibung</label>
        <input type="text" id="inputSubtitle" placeholder="z.B. Dokumentation fertigstellen">
      </div>

      <div class="field">
        <label>Datum & Uhrzeit *</label>
        <input type="datetime-local" id="inputDate">
      </div>

      <div class="field">
        <label>Icon</label>
        <div class="icon-picker" id="iconPicker"></div>
      </div>

      <div class="field">
        <label>Farbe</label>
        <div class="color-picker" id="colorPicker"></div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-cancel" onclick="closeModal()">Abbrechen</button>
        <button class="btn btn-save" id="btnSave" onclick="saveDeadline()">Hinzuf√ºgen</button>
      </div>
    </div>
  </div>

  <!-- Delete Confirm -->
  <div class="confirm-overlay" id="confirmOverlay" onclick="if(event.target===this)closeConfirm()">
    <div class="confirm-box">
      <div class="confirm-text">
        <span id="confirmName"></span><br>wirklich l√∂schen?
      </div>
      <div class="modal-actions">
        <button class="btn btn-cancel" onclick="closeConfirm()">Abbrechen</button>
        <button class="btn btn-danger" id="btnConfirmDelete" onclick="confirmDelete()">L√∂schen</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "deadline-tracker-data";
    const ICONS = ["üéØ", "üìÖ", "üíº", "üî•", "‚ö°", "üèÜ", "üìå", "üõ†Ô∏è", "üéì", "üí°", "üöÄ", "üìù", "üì¶", "üè¢"];
    const COLORS = ["#F59E0B", "#EF4444", "#3B82F6", "#8B5CF6", "#10B981", "#EC4899", "#F97316", "#06B6D4"];

    let selectedIcon = ICONS[0];
    let selectedColor = COLORS[0];
    let editingId = null;
    let deletingId = null;

    // --- Storage ---
    function loadDeadlines() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        const list = saved ? JSON.parse(saved) : [];
        return list.sort((a, b) => new Date(a.date) - new Date(b.date));
      } catch (e) {
        return [];
      }
    }

    function saveDeadlines(deadlines) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(deadlines));
    }

    // --- Helpers ---
    function pad(n) { return String(n).padStart(2, "0"); }

    function getTimeLeft(dateStr) {
      const diff = new Date(dateStr) - new Date();
      if (diff <= 0) return { days: 0, hours: 0, minutes: 0, seconds: 0, done: true };
      return {
        days: Math.floor(diff / 864e5),
        hours: Math.floor((diff / 36e5) % 24),
        minutes: Math.floor((diff / 6e4) % 60),
        seconds: Math.floor((diff / 1e3) % 60),
        done: false,
      };
    }

    function getProgress(dateStr) {
      const now = new Date();
      const target = new Date(dateStr);
      const created = new Date(dateStr);
      // Progress based on time remaining in current span (30 days before deadline as baseline)
      const span = 30 * 864e5;
      const start = new Date(target.getTime() - span);
      if (now < start) return 0;
      const elapsed = now - start;
      return Math.min(100, Math.max(0, (elapsed / span) * 100));
    }

    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString("de-DE", {
        weekday: "long", day: "numeric", month: "long", year: "numeric",
      });
    }

    function formatTime(dateStr) {
      return new Date(dateStr).toLocaleTimeString("de-DE", {
        hour: "2-digit", minute: "2-digit",
      });
    }

    // --- Render ---
    function buildCards() {
      const container = document.getElementById("cards");
      container.innerHTML = "";
      const deadlines = loadDeadlines();

      if (deadlines.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚è≥</div>
            <div class="empty-title">Keine Deadlines</div>
            <div class="empty-text">F√ºge deine erste Deadline hinzu!</div>
          </div>
        `;
        return;
      }

      deadlines.forEach((dl, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.style.borderColor = dl.accent + "22";
        card.style.animation = `fadeIn 0.6s ease ${0.1 + i * 0.1}s both`;

        card.innerHTML = `
          <button class="delete-btn" onclick="askDelete('${dl.id}')" title="L√∂schen">‚úï</button>
          <div class="card-glow" style="background: radial-gradient(circle, ${dl.accent}0A 0%, transparent 70%)"></div>
          <div class="card-header">
            <div class="card-header-left">
              <span class="card-icon">${dl.icon}</span>
              <span class="card-title" style="color: ${dl.accent}">${dl.title}</span>
            </div>
            <span class="badge-urgent" id="badge-${dl.id}" style="background: ${dl.accent}">Bald</span>
          </div>
          <div class="card-subtitle">${dl.subtitle || ""}</div>
          <div class="card-date">${formatDate(dl.date)} ¬∑ ${formatTime(dl.date)}</div>
          <div id="countdown-${dl.id}" class="countdown"></div>
          <div class="progress-track">
            <div class="progress-fill" id="progress-${dl.id}" style="background: linear-gradient(90deg, ${dl.accent}44, ${dl.accent})"></div>
          </div>
          <div class="progress-labels">
            <span>Heute</span>
            <span id="progress-label-${dl.id}"></span>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function tick() {
      const now = new Date();
      document.getElementById("headerTime").textContent =
        now.toLocaleDateString("de-DE", { weekday: "long", day: "numeric", month: "long", year: "numeric" })
        + " ¬∑ " +
        now.toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit", second: "2-digit" });

      const deadlines = loadDeadlines();
      deadlines.forEach((dl) => {
        const t = getTimeLeft(dl.date);
        const p = getProgress(dl.date);
        const el = document.getElementById(`countdown-${dl.id}`);
        const badge = document.getElementById(`badge-${dl.id}`);
        const fill = document.getElementById(`progress-${dl.id}`);
        const label = document.getElementById(`progress-label-${dl.id}`);
        if (!el) return;

        if (t.done) {
          el.innerHTML = `<div class="done-message" style="color: ${dl.accent}">üéØ ERREICHT</div>`;
        } else {
          el.innerHTML = `
            <div class="countdown-unit">
              <div class="countdown-value" style="text-shadow: 0 0 40px ${dl.accent}33">${pad(t.days)}</div>
              <div class="countdown-label" style="color: ${dl.accent}">Tage</div>
            </div>
            <div class="countdown-sep" style="color: ${dl.accent}66">:</div>
            <div class="countdown-unit">
              <div class="countdown-value" style="text-shadow: 0 0 40px ${dl.accent}33">${pad(t.hours)}</div>
              <div class="countdown-label" style="color: ${dl.accent}">Std</div>
            </div>
            <div class="countdown-sep" style="color: ${dl.accent}66">:</div>
            <div class="countdown-unit">
              <div class="countdown-value" style="text-shadow: 0 0 40px ${dl.accent}33">${pad(t.minutes)}</div>
              <div class="countdown-label" style="color: ${dl.accent}">Min</div>
            </div>
            <div class="countdown-sep" style="color: ${dl.accent}66">:</div>
            <div class="countdown-unit">
              <div class="countdown-value" style="text-shadow: 0 0 40px ${dl.accent}33">${pad(t.seconds)}</div>
              <div class="countdown-label" style="color: ${dl.accent}">Sek</div>
            </div>
          `;
        }

        if (badge) badge.classList.toggle("visible", t.days < 14 && !t.done);
        if (fill) fill.style.width = p + "%";
        if (label) label.textContent = Math.round(p) + "%";
      });
    }

    // --- Modal ---
    function buildPickers() {
      const iconPicker = document.getElementById("iconPicker");
      ICONS.forEach((icon) => {
        const btn = document.createElement("button");
        btn.className = "icon-option" + (icon === selectedIcon ? " selected" : "");
        btn.textContent = icon;
        btn.type = "button";
        btn.onclick = () => {
          selectedIcon = icon;
          iconPicker.querySelectorAll(".icon-option").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
        };
        iconPicker.appendChild(btn);
      });

      const colorPicker = document.getElementById("colorPicker");
      COLORS.forEach((color) => {
        const btn = document.createElement("button");
        btn.className = "color-option" + (color === selectedColor ? " selected" : "");
        btn.style.background = color;
        btn.type = "button";
        btn.onclick = () => {
          selectedColor = color;
          colorPicker.querySelectorAll(".color-option").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
        };
        colorPicker.appendChild(btn);
      });
    }

    function openModal() {
      editingId = null;
      selectedIcon = ICONS[0];
      selectedColor = COLORS[0];
      document.getElementById("modalTitle").textContent = "Neue Deadline";
      document.getElementById("btnSave").textContent = "Hinzuf√ºgen";
      document.getElementById("inputTitle").value = "";
      document.getElementById("inputSubtitle").value = "";
      document.getElementById("inputDate").value = "";
      document.getElementById("inputTitle").style.borderColor = "#1E293B";
      document.getElementById("inputDate").style.borderColor = "#1E293B";
      resetPickers();
      document.getElementById("modalOverlay").classList.add("open");
    }

    function closeModal() {
      document.getElementById("modalOverlay").classList.remove("open");
    }

    function resetPickers() {
      document.querySelectorAll(".icon-option").forEach((btn, i) => {
        btn.classList.toggle("selected", ICONS[i] === selectedIcon);
      });
      document.querySelectorAll(".color-option").forEach((btn, i) => {
        btn.classList.toggle("selected", COLORS[i] === selectedColor);
      });
    }

    function saveDeadline() {
      const title = document.getElementById("inputTitle").value.trim();
      const subtitle = document.getElementById("inputSubtitle").value.trim();
      const dateVal = document.getElementById("inputDate").value;

      let valid = true;
      if (!title) {
        document.getElementById("inputTitle").style.borderColor = "#EF4444";
        valid = false;
      } else {
        document.getElementById("inputTitle").style.borderColor = "#1E293B";
      }
      if (!dateVal) {
        document.getElementById("inputDate").style.borderColor = "#EF4444";
        valid = false;
      } else {
        document.getElementById("inputDate").style.borderColor = "#1E293B";
      }
      if (!valid) return;

      const deadlines = loadDeadlines();

      const newDeadline = {
        id: "dl-" + Date.now(),
        title,
        subtitle,
        date: new Date(dateVal).toISOString(),
        accent: selectedColor,
        icon: selectedIcon,
      };

      deadlines.push(newDeadline);
      saveDeadlines(deadlines);
      closeModal();
      buildCards();
      tick();
    }

    // --- Delete ---
    function askDelete(id) {
      deletingId = id;
      const deadlines = loadDeadlines();
      const dl = deadlines.find(d => d.id === id);
      if (!dl) return;
      document.getElementById("confirmName").innerHTML =
        `<span style="color: ${dl.accent}">${dl.icon} ${dl.title}</span>`;
      document.getElementById("confirmOverlay").classList.add("open");
    }

    function closeConfirm() {
      deletingId = null;
      document.getElementById("confirmOverlay").classList.remove("open");
    }

    function confirmDelete() {
      if (!deletingId) return;
      const deadlines = loadDeadlines().filter(d => d.id !== deletingId);
      saveDeadlines(deadlines);
      closeConfirm();
      buildCards();
      tick();
    }

    // --- Init ---
    buildPickers();
    buildCards();
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
